<!doctype html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="logo.fw.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eren Panel ‚Äî Home</title>
  <style>
    :root {
      --bg:#071022; --card:#0f1724; --muted:#9fbddf; --accent:#ffd166;
      --mini-size:110px;
    }
    body {
      margin:0; font-family:Poppins,system-ui,Arial;
      background:var(--bg); color:#eaf6ff; text-align:center;
    }
    .wrap { max-width:800px; margin:80px auto; padding:20px; }
    h1 { font-size:2em; margin-bottom:0.3em; }
    p.small { color:var(--muted); font-size:0.9em; margin-bottom:2em; }

    /* Claim button */
    .claim-btn {
      padding:16px 40px; font-size:20px;
      background:linear-gradient(90deg,#007bff,#00c8ff);
      color:#fff; border:none; border-radius:50px;
      cursor:pointer; font-weight:700;
      box-shadow:0 0 15px rgba(0,200,255,.4);
      transition:all 0.3s ease;
    }
    .claim-btn:hover {
      transform:scale(1.05);
      box-shadow:0 0 25px rgba(0,200,255,.6);
    }

    /* Full-screen ad overlay */
    #ad-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;background:rgba(0,0,0,0.55)}
    #ad-card{width:min(92vw,900px);background:#081226;border-radius:12px;padding:10px;position:relative;overflow:hidden}
    #ad-close{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.35);border:none;color:#fff;font-size:18px;padding:6px 9px;border-radius:6px;cursor:pointer}
    .ad-track{display:flex;transition:transform .45s ease-in-out;will-change:transform;}
    .ad-slide{min-width:100%;padding:8px;box-sizing:border-box}
    .ad-slide img, .ad-slide video{width:100%;height:auto;border-radius:8px;display:block}
    .ad-caption{text-align:center;color:#fff;padding:8px 6px;font-weight:700}

    /* mini corner ad */
    #mini-ad{position:fixed;z-index:9998;width:var(--mini-size);height:var(--mini-size);right:18px;bottom:18px;background:#081226;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.6);display:none;overflow:hidden;cursor:pointer}
    #mini-thumb{width:100%;height:66%;background:#011;display:flex;align-items:center;justify-content:center;overflow:hidden}
    #mini-thumb img, #mini-thumb video{max-width:100%;max-height:100%;display:block}
    #mini-meta{padding:6px;font-size:13px;color:var(--muted);height:34%}
    #mini-close{position:absolute;top:4px;right:4px;background:rgba(0,0,0,0.35);border:none;color:#fff;padding:4px;border-radius:6px;font-size:12px;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Welcome to Eren Panel</h1>
    <p class="small">Claim your daily reward and enjoy synced advertisements managed by admin.</p>

    <!-- Daily claim button -->
    <button class="claim-btn" onclick="window.location.href='dailyclaim.html'">
      üéÅ Claim Daily Reward
    </button>
  </div>

  <!-- full overlay ad -->
  <div id="ad-overlay" role="dialog" aria-hidden="true">
    <div id="ad-card">
      <button id="ad-close" aria-label="Close ad">‚úï</button>
      <div id="ad-inner" style="position:relative;overflow:hidden">
        <div style="overflow:hidden">
          <div id="ad-track" class="ad-track"></div>
        </div>
        <div id="ad-caption" class="ad-caption"></div>
      </div>
    </div>
  </div>

  <!-- mini ad -->
  <div id="mini-ad" title="Open ad">
    <button id="mini-close" aria-label="Close mini ad">‚úï</button>
    <div id="mini-thumb"></div>
    <div id="mini-meta"></div>
  </div>

  <!-- firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
  // -------------------- Firebase Init --------------------
  const firebaseConfig = {
    apiKey: "AIzaSyAXZQi1Wdwf7oHRVapWNGgcCYtd4Dy5kQk",
    authDomain: "eren-c4b30.firebaseapp.com",
    projectId: "eren-c4b30",
    storageBucket: "eren-c4b30.appspot.com",
    messagingSenderId: "91279547740",
    appId: "1:91279547740:web:11cc9f1eb5423f94993599",
    measurementId: "G-LPF98ZZ527"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // -------------------- Time Sync --------------------
  let serverOffset = 0;
  async function syncServerTime() {
    try {
      const ref = db.collection('serverTime').doc('now');
      await ref.set({ ts: firebase.firestore.FieldValue.serverTimestamp() });
      const snap = await ref.get();
      const data = snap.data();
      serverOffset = data?.ts?.toDate().getTime() - Date.now();
    } catch(e) {
      console.error('time sync failed', e);
      serverOffset = 0;
    }
  }
  syncServerTime();
  setInterval(syncServerTime, 5*60*1000);

  // -------------------- Ads Logic --------------------
  let ads = [];
  const adOverlay = document.getElementById('ad-overlay');
  const adTrack = document.getElementById('ad-track');
  const adCaption = document.getElementById('ad-caption');
  const adClose = document.getElementById('ad-close');
  const miniAd = document.getElementById('mini-ad');
  const miniThumb = document.getElementById('mini-thumb');
  const miniMeta = document.getElementById('mini-meta');
  const miniClose = document.getElementById('mini-close');

  const INITIAL_OVERLAY_DURATION = 10 * 1000; // 10s
  const OVERLAY_SLIDE_INTERVAL = 2000; // 2s
  const MINI_CYCLE_INTERVAL = 6000; // 6s
  let firstAdShown=false, overlayTimer, overlaySlideTimer, miniTimer, overlayIndex=0;

  db.collection('advertisements').orderBy('createdAt','desc').onSnapshot(snap=>{
    ads = snap.docs.map(d=>({id:d.id,...d.data()}));
    if (ads.length && !firstAdShown) {
      firstAdShown=true; showOverlay();
    }
  });

  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

  function buildSlides(){
    adTrack.innerHTML=''; if(!ads.length)return;
    const arr=[...ads]; shuffle(arr);
    arr.forEach(a=>{
      const slide=document.createElement('div'); slide.className='ad-slide';
      if(a.type==='image'){const link=document.createElement('a'); link.href=a.meta?.link||'#'; link.target='_blank';
        const img=document.createElement('img'); img.src=a.payload||''; link.appendChild(img); slide.appendChild(link);}
      else if(a.type==='video'){const v=document.createElement('video'); v.src=a.payload||''; v.controls=true; slide.appendChild(v);}
      else{const t=document.createElement('div'); t.textContent=a.payload||''; slide.appendChild(t);}
      adTrack.appendChild(slide);
    });
    adTrack.style.transform='translateX(0%)'; overlayIndex=0;
    adCaption.textContent=arr[0]?.meta?.title||'';
  }

  function showOverlay(){
    if(!ads.length)return;
    buildSlides();
    adOverlay.style.display='flex';
    overlaySlideTimer=setInterval(nextSlide,OVERLAY_SLIDE_INTERVAL);
    overlayTimer=setTimeout(()=>hideOverlay(),INITIAL_OVERLAY_DURATION);
  }

  function nextSlide(){
    const slides=adTrack.children.length; if(!slides)return;
    overlayIndex=(overlayIndex+1)%slides;
    adTrack.style.transform=`translateX(${-overlayIndex*100}%)`;
  }

  function hideOverlay(){
    clearInterval(overlaySlideTimer); clearTimeout(overlayTimer);
    adOverlay.style.display='none'; showMini();
  }
  adClose.onclick=hideOverlay;

  function renderMini(ad){
    miniThumb.innerHTML='';
    miniMeta.textContent=ad.meta?.title||'Ad';
    if(ad.type==='image'){
      const a=document.createElement('a'); a.href=ad.meta?.link||'#'; a.target='_blank';
      const img=document.createElement('img'); img.src=ad.payload||''; a.appendChild(img); miniThumb.appendChild(a);
    } else if(ad.type==='video'){
      const txt=document.createElement('div'); txt.textContent='Video'; txt.style.color='#fff'; miniThumb.appendChild(txt);
    } else {
      const txt=document.createElement('div'); txt.textContent=ad.payload||''; txt.style.color='#fff'; miniThumb.appendChild(txt);
    }
  }

  function showMini(){
    if(!ads.length)return;
    miniAd.style.display='block';
    let idx=0; renderMini(ads[idx]);
    clearInterval(miniTimer);
    miniTimer=setInterval(()=>{idx=(idx+1)%ads.length; renderMini(ads[idx]);},MINI_CYCLE_INTERVAL);
  }
  miniClose.onclick=e=>{e.stopPropagation(); miniAd.style.display='none'; clearInterval(miniTimer);};
  miniAd.onclick=e=>{if(e.target.id!=='mini-close'){showOverlay();}};
  </script>
</body>
</html>
