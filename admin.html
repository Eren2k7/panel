<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Panels & Ads (Firebase)</title>
  <style>
    :root{--bg:#071024;--card:#0f1724;--muted:#9fbddf;--accent:#2b9cff}
    body{font-family:Inter,system-ui,Arial;margin:0;padding:20px;background:var(--bg);color:#e6eef8;}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:18px;}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.6);}
    h1,h2{margin:0 0 10px}
    label{display:block;margin-top:8px;color:var(--muted);font-size:13px}
    input[type="text"],input[type="url"],input[type="email"],input[type="password"],textarea,select{
      width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#081120;color:#eaf6ff;
    }
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:#02102a;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn-danger{background:#ff6b6b;color:#fff}
    .small{font-size:13px;color:var(--muted)}
    .list{max-height:60vh;overflow:auto;margin-top:10px;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03)}
    .item{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center}
    .thumb{width:120px;height:72px;flex-shrink:0;background:#021;display:flex;align-items:center;justify-content:center;border-radius:6px;overflow:hidden}
    .thumb img, .thumb video{max-width:100%;max-height:100%;display:block}
    .meta{flex:1}
    .muted{color:#9fbddf;font-size:13px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
    .auth{display:flex;gap:8px;align-items:center}
    .linkish{color:#9fd6ff;text-decoration:underline}
    .note{font-size:13px;color:#9fbddf;margin-top:8px}
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Admin — Panels & Ads</h1>
    <div class="auth card" id="auth-ui" style="padding:8px;">
      <!-- auth UI replaced by JS -->
      <div id="signed-out-ui">
        <input id="admin-email" type="email" placeholder="admin email" style="width:220px;padding:8px;border-radius:6px"/>
        <input id="admin-pass" type="password" placeholder="password" style="width:160px;padding:8px;border-radius:6px"/>
        <button id="btn-signin">Sign in</button>
        <button id="btn-create" style="background:#4ad07a;color:#04210b">Create</button>
      </div>
      <div id="signed-in-ui" style="display:none;align-items:center;gap:8px;">
        <span id="who" class="muted"></span>
        <button id="btn-signout" class="btn-danger">Sign out</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- LEFT: Forms -->
    <div>
      <div class="card">
        <h2>Upload Panel (single)</h2>
        <label>Email</label>
        <input id="panel-email" type="email" placeholder="panel@example.com" />
        <label>Password</label>
        <input id="panel-pass" type="text" placeholder="password" />
        <label>Panel URL</label>
        <input id="panel-url" type="url" placeholder="https://..." />
        <div class="row" style="margin-top:8px">
          <button id="btn-save-panel">Save Panel</button>
          <button id="btn-clear-panels" class="btn-danger">Clear all panels</button>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <h2>Upload Panels (JSON)</h2>
        <label>JSON file (array of panels: {email,password,panel_url})</label>
        <input id="json-file" type="file" accept=".json" />
        <div class="row" style="margin-top:8px">
          <button id="btn-upload-json">Upload JSON</button>
        </div>
        <p class="note">You can upload many panels at once. Invalid entries are skipped.</p>
      </div>

      <div class="card" style="margin-top:12px;">
        <h2>Create Advertisement</h2>
        <label>Type</label>
        <select id="ad-type">
          <option value="image">Image</option>
          <option value="video">Video</option>
          <option value="text">Text</option>
        </select>

        <label id="media-label">Image / Video file (or leave blank to use URL)</label>
        <input id="media-file" type="file" accept="image/*,video/*" />

        <label id="url-label">Or paste media URL (image/video) or text content (for Text)</label>
        <input id="media-url" type="text" placeholder="https://... or ad text" />

        <label>Title (optional)</label>
        <input id="ad-title" type="text" placeholder="Short headline" />
        <label>Clickable target link (optional)</label>
        <input id="ad-link" type="url" placeholder="https://..." />

        <div class="row" style="margin-top:8px">
          <button id="btn-save-ad">Save Ad</button>
          <button id="btn-clear-ads" class="btn-danger">Clear all ads</button>
        </div>

        <p class="note">If you upload a file it will be uploaded to Firebase Storage and the download URL saved in Firestore.</p>
      </div>
    </div>

    <!-- RIGHT: Lists -->
    <div>
      <div class="card">
        <h2>Panels (live)</h2>
        <div id="panel-list" class="list"><div class="small">Loading…</div></div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h2>Advertisements (live)</h2>
        <div id="ad-list" class="list"><div class="small">Loading…</div></div>
      </div>
    </div>
  </div>

  <style>
    .glow-btn2 {
        display: inline-block;
        margin: 20px auto;
        padding: 30px 20px;
        font-size: 14px;
        color: #fff;
        background: #007bff; /* Blue inside */
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 0 15px #007bff, 0 0 30px #007bff;
        transition: 0.3s;
        text-align: center;
    }

    .glow-btn2:hover {
        box-shadow: 0 0 25px #00a2ff, 0 0 20px #00a2ff;
        transform: scale(1.05);
    }
</style>
<div style="text-align: center; margin: 20px 0;">
    <a href="https://catbox.moe/">
        <button class="glow-btn2" title="catbox">Converter</button>
    </a>

    <a href="https://litterbox.catbox.moe/">
      <button class="glow-btn2" title="catbox">Converter (Tempoary)</button>
  </a>
</div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

  <script>
    // ---------- CONFIG ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAXZQi1Wdwf7oHRVapWNGgcCYtd4Dy5kQk",
      authDomain: "eren-c4b30.firebaseapp.com",
      projectId: "eren-c4b30",
      storageBucket: "eren-c4b30.appspot.com",
      messagingSenderId: "91279547740",
      appId: "1:91279547740:web:11cc9f1eb5423f94993599",
      measurementId: "G-LPF98ZZ527"
    };
  
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
  
    // ---------- ELEMENTS ----------
    const signedOutUI = document.getElementById('signed-out-ui');
    const signedInUI = document.getElementById('signed-in-ui');
    const who = document.getElementById('who');
    const panelEmail = document.getElementById('panel-email');
    const panelPass = document.getElementById('panel-pass');
    const panelUrl = document.getElementById('panel-url');
    const jsonFile = document.getElementById('json-file');
    const adType = document.getElementById('ad-type');
    const mediaFile = document.getElementById('media-file');
    const mediaUrl = document.getElementById('media-url');
    const adTitle = document.getElementById('ad-title');
    const adLink = document.getElementById('ad-link');
    const panelListEl = document.getElementById('panel-list');
    const adListEl = document.getElementById('ad-list');
  
    // ---------- AUTH ----------
    document.getElementById('btn-signin').onclick = async () => {
      const email = document.getElementById('admin-email').value.trim();
      const pass = document.getElementById('admin-pass').value;
      if (!email || !pass) return alert('Enter email and password');
      try {
        await auth.signInWithEmailAndPassword(email, pass);
        alert('Signed in!');
      } catch (e) {
        alert('Sign in failed: ' + e.message);
      }
    };
  
    document.getElementById('btn-create').onclick = async () => {
      const email = document.getElementById('admin-email').value.trim();
      const pass = document.getElementById('admin-pass').value;
      if (!email || !pass) return alert('Enter email and password');
      try {
        await auth.createUserWithEmailAndPassword(email, pass);
        alert('Account created, now sign in.');
      } catch (e) {
        alert('Create failed: ' + e.message);
      }
    };
  
    document.getElementById('btn-signout').onclick = () => auth.signOut();
  
    auth.onAuthStateChanged((user) => {
      if (user) {
        signedOutUI.style.display = 'none';
        signedInUI.style.display = 'flex';
        who.textContent = user.email;
        enableControls(true);
      } else {
        signedOutUI.style.display = 'flex';
        signedInUI.style.display = 'none';
        who.textContent = '';
        enableControls(false);
      }
    });
  
    function enableControls(enabled) {
      const controls = document.querySelectorAll(
        '#panel-email,#panel-pass,#panel-url,#json-file,#ad-type,#media-file,#media-url,#ad-title,#ad-link,#btn-save-panel,#btn-clear-panels,#btn-upload-json,#btn-save-ad,#btn-clear-ads'
      );
      controls.forEach(el => {
        el.disabled = !enabled;
        el.style.opacity = enabled ? 1 : 0.5;
      });
    }
  
    // ---------- PANELS ----------
    document.getElementById('btn-save-panel').onclick = async () => {
      const email = panelEmail.value.trim();
      const password = panelPass.value.trim();
      const url = panelUrl.value.trim();
      if (!email || !password || !url) return alert('Fill all fields');
      try {
        await db.collection('panels').add({
          email, password, panel_url: url,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        panelEmail.value = panelPass.value = panelUrl.value = '';
        alert('Panel saved!');
      } catch (e) {
        alert('Error: ' + e.message);
      }
    };
  
    document.getElementById('btn-upload-json').onclick = async () => {
      const f = jsonFile.files[0];
      if (!f) return alert('Select a JSON file');
      const data = JSON.parse(await f.text());
      if (!Array.isArray(data)) return alert('Invalid JSON format');
      const batch = db.batch();
      data.forEach((p) => {
        if (p.email && p.password && p.panel_url) {
          const ref = db.collection('panels').doc();
          batch.set(ref, { ...p, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        }
      });
      await batch.commit();
      alert('JSON uploaded!');
    };
  
    document.getElementById('btn-clear-panels').onclick = async () => {
      if (!confirm('Delete ALL panels?')) return;
      const snap = await db.collection('panels').get();
      const batch = db.batch();
      snap.forEach(d => batch.delete(d.ref));
      await batch.commit();
      alert('Panels cleared');
    };
  
    db.collection('panels').orderBy('createdAt', 'desc').onSnapshot((snap) => {
      panelListEl.innerHTML = '';
      if (snap.empty) {
        panelListEl.innerHTML = '<div class="small">No panels yet</div>';
        return;
      }
      snap.forEach(doc => {
        const d = doc.data();
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = `
          <div class="meta">
            <b>${d.email}</b><br>
            <span class="muted">${d.panel_url}</span>
          </div>
          <button onclick="deletePanel('${doc.id}')" class="btn-danger">Delete</button>`;
        panelListEl.appendChild(el);
      });
    });
  
    async function deletePanel(id) {
      if (confirm('Delete this panel?')) await db.collection('panels').doc(id).delete();
    }
  
    // ---------- ADS ----------
    async function uploadToStorage(file, folder) {
      const path = `${folder}/${Date.now()}_${file.name}`;
      const ref = storage.ref().child(path);
      await ref.put(file);
      return await ref.getDownloadURL();
    }
  
    document.getElementById('btn-save-ad').onclick = async () => {
      const type = adType.value;
      const title = adTitle.value.trim();
      const link = adLink.value.trim();
      const file = mediaFile.files[0];
      const urlInput = mediaUrl.value.trim();
      let payload = '';
  
      try {
        if (type === 'text') {
          if (!urlInput) return alert('Enter ad text');
          payload = urlInput;
        } else if (file) {
          payload = await uploadToStorage(file, type === 'image' ? 'ads/images' : 'ads/videos');
        } else if (urlInput) {
          payload = urlInput;
        } else return alert('Provide media file or URL');
  
        await db.collection('advertisements').add({
          type,
          payload,
          meta: { title, link },
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
  
        mediaFile.value = '';
        mediaUrl.value = adTitle.value = adLink.value = '';
        alert('Ad saved!');
      } catch (e) {
        alert('Failed: ' + e.message);
      }
    };
  
    document.getElementById('btn-clear-ads').onclick = async () => {
      if (!confirm('Delete ALL ads?')) return;
      const snap = await db.collection('advertisements').get();
      const batch = db.batch();
      snap.forEach(d => batch.delete(d.ref));
      await batch.commit();
      alert('Ads cleared');
    };
  
    db.collection('advertisements').orderBy('createdAt', 'desc').onSnapshot((snap) => {
      adListEl.innerHTML = '';
      if (snap.empty) {
        adListEl.innerHTML = '<div class="small">No ads yet</div>';
        return;
      }
      snap.forEach(doc => {
        const d = doc.data();
        const el = document.createElement('div');
        el.className = 'item';
        let preview = '';
        if (d.type === 'image') preview = `<img src="${d.payload}" style="max-width:100px;border-radius:6px"/>`;
        else if (d.type === 'video') preview = `<video src="${d.payload}" width="100" controls></video>`;
        else preview = `<div>${d.payload}</div>`;
        el.innerHTML = `
          <div class="thumb">${preview}</div>
          <div class="meta"><b>${d.meta?.title || d.type}</b><br>
          <a href="${d.meta?.link || '#'}" target="_blank" class="linkish">${d.meta?.link || ''}</a></div>
          <button onclick="deleteAd('${doc.id}')" class="btn-danger">Delete</button>`;
        adListEl.appendChild(el);
      });
    });
  
    async function deleteAd(id) {
      if (confirm('Delete this ad?')) await db.collection('advertisements').doc(id).delete();
    }
  
    // ---------- UTIL ----------
    function copyToClipboard(txt) {
      navigator.clipboard.writeText(txt).then(() => alert('Copied!'));
    }
  
    enableControls(false);
  </script>
  
</body>
</html>
